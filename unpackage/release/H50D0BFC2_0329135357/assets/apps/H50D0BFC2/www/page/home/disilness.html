<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>常见疾病</title>
		<link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../bootstrap/fonts/font-awesome.css"/>
		<link rel="stylesheet" href="../../plugins/layui/css/layui.css" />
		<link rel="stylesheet" href="../../css/base.css"/>
		<link rel="stylesheet" href="../../plugins/ScrollBar/style.min.css"/>
		<link rel="stylesheet" href="../../css/mui.min.css">
	</head>
	<body class="bg">
		<!--<div class="header clearfix">
			<i id="back" class=" fa fa-angle-left left" ></i>
			<span class="left title-infor">常见疾病</span>
		</div>-->
		<!--<div id="departmentlistrefresh">-->
			<div id="departmentlist" class="container-fluid contain-box">
				<!--<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>感冒</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>高血压</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>冠心病</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>甲亢</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>甲减</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>慢性胆囊炎</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>慢性肝炎</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>慢性胃炎</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>矽肺</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼</li>
					</ul>
				</ul>
				<ul class="bg-white news">
					<div class="clearfix news-header">
						<a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>慢性心率衰竭</a>
						<i class="right fa fa-angle-right text-black-light"></i>
					</div>
					<ul class="news-box">
						<li>眼科眼科眼科眼科眼科眼科眼科眼33333</li>
					</ul>
				</ul>-->
			</div>
		<!--</div>-->
	</body>
	<script type="text/javascript" src="../../js/mui.js" ></script>
	<!--<script src="../../js/jquery-2.2.3.min.js"></script>-->
	<!--滚动条隐藏-->
	<!--<script src="../../plugins/ScrollBar/mousewheel.min.js"></script>
	<script src="../../plugins/ScrollBar/scrollbar.min.js"></script>-->
	
	<script type="text/javascript">
		/*var H = $(window).height()-40;
		$(".contain-box").css("height",H);
		$('.contain-box').perfectScrollbar();*/
	</script>
	<script type="text/javascript">
		mui.init({
		  pullRefresh : {
		    container:"#departmentlist",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
		   /* down : {
		      height:50,//可选,默认50.触发下拉刷新拖动距离,
		      auto: false,//可选,默认false.首次加载自动下拉刷新一次
		      contentdown : "下拉可以刷新",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
		      contentover : "释放立即刷新",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
		      contentrefresh : "正在刷新...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
		      callback :pullfreshDown //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
		    },*/
		    up : {
		    height:25,//可选.默认50.触发上拉加载拖动距离
		    auto:true,//可选,默认false.自动上拉加载一次
		    contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
		    contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
		    callback :pullfreshUp //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
		    }
		  }
		});
		mui.plusReady(function () {
			//自定义事件
			window.addEventListener("getDisilnessdata",function (event) {
				getDiseas (lasttime);
			});
			});
			//上拉加载更多
		function pullfreshUp () {
			setTimeout(function () {	
			getDiseas (lasttime);
			mui('#departmentlist').pullRefresh().endPullupToRefresh(false); //参数为true代表没有更多数据了。
			},500);
			
			
		}
		//下拉刷新
		function pullfreshDown () {
			var nowtime = getNowFormatDate(); 
			getDiseas (nowtime);
			setTimeout(function () {
			mui('#departmentlist').pullRefresh().endPulldownToRefresh(); //refresh completed
			},1000);

		}	
	</script>
	<script type="text/javascript">
		var commitlist = new Array();
		var lasttime = getNowFormatDate();
		var disilnessdata = '';
		function getDiseas (lasttime1) {
				var nowtimeis = getNowFormatDate();
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/illnessActionApp/getIllListApp.do";
				mui.ajax(url,{
				data:{
					startTime:lasttime
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				plus.nativeUI.showWaiting("加载中", {});
				mask.show();//显示遮罩层
				console.log("getDiseas---->>>>>"+data);
				disilnessdata = data;
				var loginresult = JSON.parse(data);
				var code = loginresult.code;
				var lasttimeS = '';
				if ( code == "0") {
					if (loginresult.result.length>0) {
						lasttimeS = loginresult.result[loginresult.result.length-1].createTime;
						lasttime = getLocalTime(lasttimeS);
						if (lasttime1==nowtimeis) {
							commitlist = loginresult.result;
						}else{
							commitlist = commitlist.concat(loginresult.result);
						}
						
						showDisilnessList (commitlist);
					}else{
						mui.toast("没有更多数据！");
					}
					
					
					
				}
				if (code != 0) {
					mui.toast(loginresult.msg);
					
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
						//异常处理；
						plus.nativeUI.showWaiting("加载中", {});
					 	mask.show();//显示遮罩层
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						plus.nativeUI.toast("网络访问失败!");
					}
				});
			
			}
		function showDisilnessList (list) {
			
    		var newListItem = [];
			for (var disilnessi = 0;disilnessi<list.length;disilnessi++) {//\''+list[i].sign_id+'\'
		 	newListItem.push('<ul onclick="openDisilness(\''+list[disilnessi].id+'\')" class="bg-white news"><div class="clearfix news-header"><a href="#" class="left"> <i class="fa fa-volume-down margin-r-1 text-blue"></i>');
		 	newListItem.push(list[disilnessi].illName);
		 	newListItem.push('</a><i class="right fa fa-angle-right text-black-light"></i></div></ul>');
		 	
		 	}
		 	document.getElementById('departmentlist').innerHTML = newListItem.join('');
		 	/*$(".news").on('click',function () {
		 		openDoctorList ();
		 	});*/
		
		}
		function openDisilness (id) {
				mui.openWindow({
						url : "disilnessInfo.html",
						id : "disilnessInfo.html",
						extras : {
							disilnessinfoid : id,
							disdata:disilnessdata
						}
					});
		}
		function getLocalTime(nS) {
				var time = new Date(nS);
				var y = time.getFullYear();//年
				var m = time.getMonth() + 1;//月
				var d = time.getDate();//日
				var h = time.getHours();//时
				var mm = time.getMinutes();//分
				var s = time.getSeconds();//秒
				m<10?m="0"+m:m;
				d<10?d="0"+d:d;
				h<10?h="0"+h:h;
				mm<10?mm="0"+mm:mm;
				s<10?s="0"+s:s;
				return y+"-"+m+"-"+d+" "+h+":"+mm+":"+s; 
			}
		function getNowFormatDate() {
		    var date = new Date();
		    var seperator1 = "-";
		    var seperator2 = ":";
		    var month = date.getMonth() + 1;
		    var strDate = date.getDate();
		    if (month >= 1 && month <= 9) {
		        month = "0" + month;
		    }
		    if (strDate >= 0 && strDate <= 9) {
		        strDate = "0" + strDate;
		    }
		    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
		            + " " + date.getHours() + seperator2 + date.getMinutes()
		            + seperator2 + date.getSeconds();
		    return currentdate;
		}
	</script>
</html>
