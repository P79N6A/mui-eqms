<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>修改身份证号码</title>
		<link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../bootstrap/fonts/font-awesome.css"/>
		<link rel="stylesheet" href="../../plugins/layui/css/layui.css" />
		<link rel="stylesheet" href="../../css/base.css"/>
	</head>
	<body class="bg">
		<div class="header clearfix">
			<i id="back" class=" fa fa-angle-left left"></i>
			
			<span class="left title-infor">添加身份证号码</span>
			<span id="addnewIdCard" class="title-right">新增</span>
			<!--<i id="back" class=" fa fa-angle-left left"></i>-->
			<!--<span class="left title-infor">添加身份证号码</span>-->
		</div>
		<div class="container-fluid">
			<div class="row bg-white">
				<div class="col-sm-12">
					<form class="form-horizontal user-login-infor">
						<!--<div class="form-group username">
							<input id = "account" type="text" readonly="readonly" class="layui-input no-border border-bottom" placeholder="手机号"/>
							<input id="getverificationcode" type="button" class="form-control layui-btn bg-light-blue username-txt" value="获取验证" />
						</div>
						<div class="form-group">
							<input id = "verificationcode" type="text" class="layui-input no-border border-bottom" placeholder="验证码" />
						</div>
						<div class="form-group">
							<input id = "oldpassword" type="password" class="layui-input no-border border-bottom" placeholder="旧密码" />
						</div>
						<div class="form-group">
							<input id = "password" type="password" class="layui-input no-border border-bottom" placeholder="新密码" />
						</div>-->
						<div class="row login-infor-menu">
						<ul id="showIDCardNumber" class="bg-white">
							<!--<li id="idcard1"><a>370986190012122345</a></li>
							<li id="idcard2"><a>370986190011122345</a></li>
							<li id="idcard3"><a>370986190011222345</a></li>-->
							<!--<li><a>370986190011122345</a><a onclick="deleteUserIDCardNumber()">删除</a></li>-->
		
						</ul>
						</div>
						<div id="addnewIdCardInfo" hidden="hidden" class="form-group">
							<input id = "idcardnumber" type="text" class="layui-input no-border border-bottom" placeholder="身份证号码" />

						</div>
					</form>
				</div>
			</div>
			<div class="margin-t-1 margin-b-1">
<!--			<input id="login" type="button" class="form-control layui-btn bg-light-blue layui-btn-big" value="登录" onclick="window.open('index.html')" />
-->			</div>
<!--				<input id="sure" type="button" class="form-control layui-btn bg-light-blue layui-btn-big input-bt-login" value="确定"/>
-->					
		</div>
		<div>
			
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<script type="text/javascript">
			var refuseAddNewIDCard = 0;
			var inputverificationcode = "";
			var data = localStorage.getItem("loginuserinfo");
			//console.log("data----->>>>> "+data);
			var userid = JSON.parse(data).result.id;
			if(window.plus){
				
					}else{// 兼容老版本的plusready事件
				document.addEventListener('plusready',function () {			
				getUesrIDCardNumber(userid);
				var bt_back = document.getElementById("back");
				bt_back.addEventListener("tap",function () {
					var ws = plus.webview.currentWebview();
					plus.webview.close(ws);
				});
				
			
				/*var bt_sure = document.getElementById("sure");
				bt_sure.addEventListener("tap",function () {
					
					var ws = plus.webview.currentWebview();
					plus.webview.close(ws);
					
				});*/
				var isshow = "0";
				var addnewIdcard = document.getElementById("addnewIdCard");
				addnewIdcard.addEventListener('click',function () {
					if (isshow == "0") {
						if (refuseAddNewIDCard>5) {
							mui.alert("最绑定5张身份证");
						}else{
							document.getElementById("addnewIdCardInfo").hidden = false;
							isshow = "1";
							document.getElementById("addnewIdCard").innerText = "完成";
						}
						
					}else{
						document.getElementById("addnewIdCardInfo").hidden = true;
						isshow = "0";
						document.getElementById("addnewIdCard").innerText = "新增";
						
						var IDCardNmber = document.getElementById("idcardnumber").value;
						if (IDCardNmber==""||IDCardNmber==undefined||IDCardNmber=="undefined") {
							alert("请输入身份证号码！");
						}else{
							//新增身份证号
							addUesrIDCardNumber(userid,IDCardNmber);
						}
						

					}
				});
				});
		}
			function addUesrIDCardNumber (userid,IDCardNumber) {
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/appSysActionApp/addIdCardApp.do";
				mui.ajax(url,{
				data:{
					userId : userid,//idCard、userId
					idCard :IDCardNumber
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
				console.log("registerUesr---->>>>>"+data);
				var registerresult = JSON.parse(data);
				var code = registerresult.code;
				if ( code == "0") {
					mui.toast(registerresult.msg);
					document.getElementById("idcardnumber").value="";
					document.getElementById("addnewIdCardInfo").hidden = true;
					getUesrIDCardNumber (userid);
				}
				if (code != "0") {
					mui.toast(registerresult.result);
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					plus.nativeUI.closeWaiting();
		        	mask.close();//关闭遮罩层
						//异常处理；
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						//plus.nativeUI.toast("网络访问失败!");
					}
				});
			
		}
		function getUesrIDCardNumber (userid) {
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/appSysActionApp/qryIdCardApp.do";
				mui.ajax(url,{
				data:{
					userId : userid
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
				console.log("registerUesr---->>>>>"+data);
				var registerresult = JSON.parse(data);
				var code = registerresult.code;
				if ( code == "0") {
					showIDCardNumber(registerresult.result);
				}
				if (code != "0") {
					mui.toast(registerresult.result);
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					plus.nativeUI.closeWaiting();
		        	mask.close();//关闭遮罩层
						//异常处理；
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						//plus.nativeUI.toast("网络访问失败!");
					}
				});
			
		}
		
		function showIDCardNumber (list) {
			
				refuseAddNewIDCard = list.length;
//				console.log("showIDCardNumber------>>>>> "+showIDCardNumber);
//				console.log("listlength------>>>>> "+list.length);

			var newListItem = [];
		for (var idcardi = 0;idcardi<list.length;idcardi++) {
		 	newListItem.push('<li><a>');//<li><a>370986190012122345</a></li>
		 	newListItem.push(list[idcardi].idCard);
		 	newListItem.push('</a><a onclick="deleteUserIDCardNumber(\''+list[idcardi].id+'\')">删除</a></li>');
		 	
		 	}
		 	document.getElementById('showIDCardNumber').innerHTML = newListItem.join('');
		}
		function deleteUserIDCardNumber (idcardid) {
			var deleteidcardid = idcardid;
			var btnArray = ['否', '是'];  
            mui.confirm('确认删除？', '删除提示', btnArray, function(e) {  
                if (e.index == 1) {  
                    queryDeleteUserIDCardNumber(deleteidcardid);
                } else {  
                        
                }  
                });
		}
		function queryDeleteUserIDCardNumber (idcardid) {
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/appSysActionApp/delIdCardApp.do";
				mui.ajax(url,{
				data:{//idCardId、userId 
					idCardId : idcardid
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
				console.log("registerUesr---->>>>>"+data);
				var registerresult = JSON.parse(data);
				var code = registerresult.code;
				if ( code == "0") {
					getUesrIDCardNumber (userid);
				}
				if (code != "0") {
					mui.toast(registerresult.result);
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					plus.nativeUI.closeWaiting();
		        	mask.close();//关闭遮罩层
						//异常处理；
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						//plus.nativeUI.toast("网络访问失败!");
					}
				});
		}
		</script>
	</body>
</html>
