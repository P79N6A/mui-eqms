<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>缴费信息预览</title>
		<link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../../bootstrap/fonts/font-awesome.css"/>
		<link rel="stylesheet" href="../../plugins/layui/css/layui.css" />
		<link rel="stylesheet" href="../../css/base.css"/>
		<link rel="stylesheet" href="../../plugins/ScrollBar/style.min.css"/>
	</head>
	<body class="bg">
	<!--	<div class="header clearfix">
			<i class=" fa fa-angle-left left" onClick= "window.location.href=('index.html')"></i>
			<span class="left title-infor">缴费信息预览</span>
		</div>-->
		<div class="container-fluid">
			<div class="row">
				<ul class="clearfix pay-infor">
					<li class="active">维修相关</li>
					<li class="">巡检相关</li>
					<li class="">保养相关</li>
				</ul>
				<div  class="pay-item" >
					<div id="allpaylist" class="active" id='allList'>
						<!--<ul  class="pay-item-list">
							<li class="clearfix title"><span class="left title">支付信息</span><span class="right"><i class="fa fa-check text-green state-icon"></i>已付款</span></li>
							<li>&nbsp;姓名：<span>李明</span></li>
							<li>证件号码：<span>111111111111111111</span></li>
							<li>检查项目：<span>化验</span></li>
							<li>发起时间：<span>2014-08-02:09:07</span></li>
							<li>应缴费用：<span>人民币 100 元</span></li>
							<li class="footer-btn"><button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" value="">删除记录</button></li>
						</ul>-->
					</div>
					<div id='waitpaylist'>
						<ul id="" class="pay-item-list">
							<!--<li class="clearfix"><span class="left">支付信息</span><span class="right"><i class="fa fa-clock-o text-orange state-icon"></i>待支付</span></li>
							<li>姓名：<span>李明</span></li>
							<li>证件号码：<span>111111111111111111</span></li>
							<li>检查项目：<span>化验</span></li>
							<li>发起时间：<span>2014-08-02:09:07</span></li>
							<li>应缴费用：<span>人民币 100 元</span></li>
							<li class="footer-btn">
								<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small">删除记录</button>
								<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="layuis()">立即支付</button>
							</li>-->
						</ul>
					</div>
					<div id='alreadylist'>
						<ul class="pay-item-list">
						<!--	<li class="clearfix title"><span class="left title">支付信息</span><span class="right"><i class="fa fa-check text-green state-icon"></i>已付款</span></li>
							<li>姓名：<span>李明</span></li>
							<li>证件号码：<span>111111111111111111</span></li>
							<li>检查项目：<span>化验</span></li>
							<li>发起时间：<span>2014-08-02:09:07</span></li>
							<li>应缴费用：<span>人民币 100 元</span></li>
							<li class="footer-btn"><button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" value="">删除记录</button></li>-->
						</ul>
					</div>
				</div>
			</div>
		</div>
		
	</body>
	<script src="../../js/mui.js"></script>
	<script src="../../js/jquery-2.2.3.min.js"></script>
	<script src="../../plugins/layui/layui.js"></script>
	<!--底部菜单切换-->
	<script type="text/javascript">
		$('.footer a').on('click',function(){
			$(this).find('dl').addClass('active');
			$(this).siblings().find('dl').removeClass('active')
		})
	</script>
	<script type="text/javascript">
		$('.pay-infor li').on('click',function(){
			var $index=$(this).index()
			$(this).addClass('active').siblings().removeClass('active');
			$('.pay-item div').eq($index).addClass('active').siblings().removeClass('active')
		})
	</script>
	<script src="../../plugins/ScrollBar/mousewheel.min.js"></script>
	<script src="../../plugins/ScrollBar/scrollbar.min.js"></script>
	<script type="text/javascript">
		var H = $(window).height();
		$(".pay-item").css("height",H);
		$(".pay-item").css("overflow","hidden");
		$(".pay-item").perfectScrollbar();
	</script>
	<script type="text/javascript">
		
		mui.plusReady(function () {
			var a_logtext = document.getElementById("logtext");
			var loginstatus="0";
			var userinfodata = localStorage.getItem("loginuserinfo");
			if (userinfodata!=""&&userinfodata!=null) {
				loginstatus = JSON.parse(userinfodata).result.loginStatus;
				
			}
			if (loginstatus=="1") {
				getPaymentInfo ();
			}
					
		
		});
		window.addEventListener("showPaylist",function (e) {
			var loginstatus="0";
			var userinfodata = localStorage.getItem("loginuserinfo");
			if (userinfodata!=""&&userinfodata!=null) {
				loginstatus = JSON.parse(userinfodata).result.loginStatus;
				
			}
			/*if (loginstatus=="0") {
				
				mui.openWindow({
					url : "login.html",
					id : "login.html",
					extras : {
						closepage : "10011",
						openSource : ""
					}
				});
				return;
			}*/
			if (loginstatus=="1") {
				//getPaymentInfo ();
			}
			});
	</script>
	<script type="text/javascript">
			function getPaymentInfo () {
				var userinfodata = localStorage.getItem("loginuserinfo");
				var nowtime = getNowFormatDate();
				var userid = JSON.parse(userinfodata).result.id;
				var tokens =  JSON.parse(userinfodata).token;
				
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/payAction/payDetailPage.do";
				mui.ajax(url,{
				data:{
					loginUserId:userid,
					startTime:nowtime,
					payState:"all",
					token:tokens
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				console.log("getPaymentInfo ()---->>>> "+data);
				var loginresult = JSON.parse(data);
				var code = loginresult.code;
				if ( code == "0") {
					var list = loginresult.result;
					showPaymentListAll(list);
					showPaymentListWaitpPay(list);
					showPaymentListPaySuccess(list);
				}
				if (code != 0) {
					mui.toast(loginresult.msg);
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
						//异常处理；
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						plus.nativeUI.toast("网络访问失败!");
					}
				});
			
			}
	function showPaymentListAll (list) {
    	var newListItem = [];
		for (var paymenti = 0;paymenti<list.length;paymenti++) {
		 	newListItem.push('<ul  class="pay-item-list">');
		 	newListItem.push('<li class="clearfix title"><span class="left title">支付信息</span><span class="right">');
		 	newListItem.push(list[paymenti].payState=="waitPay"? "待支付":"已支付");
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>&nbsp;&nbsp;姓&nbsp;&nbsp;&nbsp;名：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>证件号码：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用类型：<span>');
		 	newListItem.push(list[paymenti].payName);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>发起时间：<span>');
		 	newListItem.push(getLocalTime(list[paymenti].createTime));
		 	newListItem.push('<li>缴费时间：<span>');
		 	newListItem.push(getLocalTime(list[paymenti].payTime));
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>应缴费用：<span>');
		 	newListItem.push(list[paymenti].oriMoney);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>实际缴费：<span>');
		 	newListItem.push(list[paymenti].payMoney);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用说明：<span>');
		 	newListItem.push(list[paymenti].payExplain);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li class="footer-btn">');
		 	newListItem.push('<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="deletePaywayInfo(\''+list[paymenti].id+'\')">删除记录</button>');
		 	newListItem.push('<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="openPayway('+list[paymenti].id+','+list[paymenti].payMoney+')">立即支付</button></li></ul>');

		 	}
		 	document.getElementById('allpaylist').innerHTML = newListItem.join('');
		 	
	}		
	function showPaymentListWaitpPay (list) {
	
    	var newListItem = [];
		for (var paymenti = 0;paymenti<list.length;paymenti++) {
			if (list[paymenti].payState=="waitPay") {
		 	newListItem.push('<ul  class="pay-item-list">');
		 	newListItem.push('<li class="clearfix title"><span class="left title">支付信息</span><span class="right">');
		 	newListItem.push('待支付');
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>&nbsp;&nbsp;姓&nbsp;&nbsp;&nbsp;名：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>证件号码：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用类型：<span>');
		 	newListItem.push(list[paymenti].payName);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>发起时间：<span>');
		 	newListItem.push(getLocalTime(list[paymenti].createTime));
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>应缴费用：<span>');
		 	newListItem.push(list[paymenti].oriMoney);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用说明：<span>');
		 	newListItem.push(list[paymenti].payExplain);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li class="footer-btn">');
		 	newListItem.push('<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="deletePaywayInfo(\''+list[paymenti].id+'\')">删除记录</button>');
		 	newListItem.push('<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="openPayway('+list[paymenti].id+','+list[paymenti].payMoney+')">立即支付</button></li></ul>');
			}
		 	}
		 	document.getElementById('waitpaylist').innerHTML = newListItem.join('');
		
	}		
	function showPaymentListPaySuccess (list) {
    	var newListItem = [];
		for (var paymenti = 0;paymenti<list.length;paymenti++) {
			if (list[paymenti].payState=="paySuccess") {
	
		 	newListItem.push('<ul  class="pay-item-list">');
		 	newListItem.push('<li class="clearfix title"><span class="left title">支付信息</span><span class="right">');
		 	newListItem.push('支付成功');
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>&nbsp;&nbsp;姓&nbsp;&nbsp;&nbsp;名：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>证件号码：<span>');
		 	newListItem.push(list[paymenti].payUser);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用类型：<span>');
		 	newListItem.push(list[paymenti].payName);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>发起时间：<span>');
		 	newListItem.push(getLocalTime(list[paymenti].createTime));
		 	newListItem.push('<li>缴费时间：<span>');
		 	newListItem.push(getLocalTime(list[paymenti].payTime));
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>应缴费用：<span>');
		 	newListItem.push(list[paymenti].oriMoney);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>实际缴费：<span>');
		 	newListItem.push(list[paymenti].payMoney);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li>费用说明：<span>');
		 	newListItem.push(list[paymenti].payExplain);
		 	newListItem.push('</span></li>');
		 	newListItem.push('<li class="footer-btn">');
		 	newListItem.push('<button class="layui-btn layui-btn-primary layui-btn-radius layui-btn-small" onclick="deletePaywayInfo(\''+list[paymenti].id+'\')">删除记录</button></li></ul>');
						
			}
		 	}
		 	document.getElementById('alreadylist').innerHTML = newListItem.join('');
		 	
	}		
			function deletePaywayInfo (payid) {
				var mask = mui.createMask();//遮罩层
				var url = localStorage.getItem("url")+"/payAction/deletePayById.do";
				mui.ajax(url,{
				data:{
					id : payid
				},
				dataType:'JSON',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:15000,//超时时间设置为10秒；
				beforeSend:function(){
					 plus.nativeUI.showWaiting("加载中", {});
					 mask.show();//显示遮罩层
				},
				complete: function() {
		        plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
		   		 },              
				success:function(data){
				plus.nativeUI.closeWaiting();
		        mask.close();//关闭遮罩层
				console.log("deletePaywayInfo---->>>>>"+data);
				var registerresult = JSON.parse(data);
				var code = registerresult.code;
				if ( code == "0") {
					getPaymentInfo();
				}
				if (code != "0") {
					mui.toast(registerresult.result);
				}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					plus.nativeUI.closeWaiting();
		        	mask.close();//关闭遮罩层
						//异常处理；
						console.log("requestNet error ："+XMLHttpRequest.status+"<-->"+XMLHttpRequest.readyState+"<-->"+textStatus);
						//plus.nativeUI.toast("网络访问失败!");
					}
				});
				}
			function openPayway (id,money) {
				mui.openWindow({
					url : "../pay/payway.html",
					id : "../pay/payway.html",
					extras : {
						payitemid : id,
						paymoney : money
					}
				});
			}
		function getLocalTime(nS) {
				var time = new Date(nS);
				var y = time.getFullYear();//年
				var m = time.getMonth() + 1;//月
				var d = time.getDate();//日
				var h = time.getHours();//时
				var mm = time.getMinutes();//分
				var s = time.getSeconds();//秒
				m<10?m="0"+m:m;
				d<10?d="0"+d:d;
				h<10?h="0"+h:h;
				mm<10?mm="0"+mm:mm;
				s<10?s="0"+s:s;
				return y+"年"+m+"月"+d+"日 "+h+":"+mm+":"+s; 
			}
		function getNowFormatDate() {
		    var date = new Date();
		    var seperator1 = "-";
		    var seperator2 = ":";
		    var month = date.getMonth() + 1;
		    var strDate = date.getDate();
		    if (month >= 1 && month <= 9) {
		        month = "0" + month;
		    }
		    if (strDate >= 0 && strDate <= 9) {
		        strDate = "0" + strDate;
		    }
		    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
		            + " " + date.getHours() + seperator2 + date.getMinutes()
		            + seperator2 + date.getSeconds();
		    return currentdate;
		}
	</script>
</html>
